<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Tipners - Community Leaderboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/viem@2.30.5/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@tanstack/react-query@5.45.1/build/umd/index.production.min.js"></script>
    <script>
        // Ensure ReactQuery is available globally
        window.ReactQuery = window.ReactQuery || window.TanStackReactQuery;
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        tipn: {
                            primary: '#8B5CF6',
                            secondary: '#A78BFA',
                            accent: '#DDD6FE'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { QueryClient, QueryClientProvider, useQuery } = window.ReactQuery || window.TanStackReactQuery;

        // Base mainnet configuration
        const BASE_MAINNET = {
            id: 8453,
            name: 'Base',
            network: 'base',
            nativeCurrency: {
                decimals: 18,
                name: 'Ether',
                symbol: 'ETH',
            },
            rpcUrls: {
                public: { http: ['https://mainnet.base.org'] },
                default: { http: ['https://mainnet.base.org'] },
            },
            blockExplorers: {
                default: { name: 'BaseScan', url: 'https://basescan.org' },
            },
        };

        // Mock data for demo - replace with actual contract calls
        const generateMockStakers = () => {
            const mockData = [];
            for (let i = 0; i < 1000; i++) {
                mockData.push({
                    address: `0x${Math.random().toString(16).substr(2, 40)}`,
                    amount: Math.floor(Math.random() * 1000000) + 1000,
                    rank: i + 1
                });
            }
            return mockData.sort((a, b) => b.amount - a.amount);
        };

        // Hook to fetch top stakers
        const useTopStakers = () => {
            return useQuery({
                queryKey: ['topStakers'],
                queryFn: async () => {
                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // In production, replace with actual viem contract call:
                    /*
                    const publicClient = viem.createPublicClient({
                        chain: BASE_MAINNET,
                        transport: viem.http()
                    });
                    
                    const data = await publicClient.readContract({
                        address: 'TIPN_CONTRACT_ADDRESS',
                        abi: TIPN_ABI,
                        functionName: 'getTopStakers',
                        args: [1000]
                    });
                    */
                    
                    return generateMockStakers();
                },
                staleTime: 5 * 60 * 1000, // 5 minutes
                refetchInterval: 30000, // Refetch every 30 seconds
            });
        };

        // Leaderboard row component
        const LeaderboardRow = ({ staker, index }) => {
            const getRankStyle = (rank) => {
                if (rank === 1) return 'bg-gradient-to-r from-yellow-400 to-yellow-600 text-black';
                if (rank === 2) return 'bg-gradient-to-r from-gray-300 to-gray-500 text-black';
                if (rank === 3) return 'bg-gradient-to-r from-amber-600 to-amber-800 text-white';
                return 'bg-gray-800 hover:bg-gray-700';
            };

            const formatAddress = (addr) => {
                return `${addr.slice(0, 6)}...${addr.slice(-4)}`;
            };

            const formatAmount = (amount) => {
                return (amount / 1e18).toLocaleString(undefined, {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 4
                });
            };

            return (
                <tr className={`transition-all duration-200 ${getRankStyle(index + 1)}`}>
                    <td className="px-6 py-4 text-center font-bold">
                        {index < 3 ? (
                            <span className="text-2xl">
                                {index === 0 ? 'ðŸ¥‡' : index === 1 ? 'ðŸ¥ˆ' : 'ðŸ¥‰'}
                            </span>
                        ) : (
                            <span className="text-lg">#{index + 1}</span>
                        )}
                    </td>
                    <td className="px-6 py-4 font-mono text-sm">
                        <a 
                            href={`https://basescan.org/address/${staker.address}`}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="hover:text-tipn-secondary transition-colors duration-200"
                        >
                            {formatAddress(staker.address)}
                        </a>
                    </td>
                    <td className="px-6 py-4 text-right font-bold text-tipn-primary">
                        {formatAmount(staker.amount)} TIPN
                    </td>
                </tr>
            );
        };

        // Main leaderboard component
        const TipnLeaderboard = () => {
            const [currentPage, setCurrentPage] = useState(1);
            const [searchTerm, setSearchTerm] = useState('');
            const itemsPerPage = 50;
            
            const { data: stakers, isLoading, isError, error } = useTopStakers();

            const filteredStakers = stakers?.filter(staker => 
                staker.address.toLowerCase().includes(searchTerm.toLowerCase())
            ) || [];

            const totalPages = Math.ceil(filteredStakers.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const paginatedStakers = filteredStakers.slice(startIndex, startIndex + itemsPerPage);

            const handlePageChange = (page) => {
                setCurrentPage(page);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            if (isLoading) {
                return (
                    <div className="flex items-center justify-center min-h-screen">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-tipn-primary mb-4 mx-auto"></div>
                            <p className="text-xl text-gray-300">Loading Top Tipners...</p>
                        </div>
                    </div>
                );
            }

            if (isError) {
                return (
                    <div className="flex items-center justify-center min-h-screen">
                        <div className="text-center bg-red-900/20 border border-red-500 rounded-lg p-8">
                            <p className="text-xl text-red-400 mb-4">Failed to load leaderboard</p>
                            <p className="text-gray-300">Please try refreshing the page</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container mx-auto px-4 py-8 max-w-6xl">
                    {/* Header */}
                    <div className="text-center mb-12">
                        <div className="mb-6">
                            <div className="inline-flex items-center justify-center w-20 h-20 bg-tipn-primary rounded-full mb-4">
                                <span className="text-3xl font-bold">T</span>
                            </div>
                        </div>
                        <h1 className="text-4xl md:text-6xl font-bold bg-gradient-to-r from-tipn-primary to-tipn-secondary bg-clip-text text-transparent mb-4">
                            Top Tipners
                        </h1>
                        <p className="text-xl text-gray-300 mb-2">
                            Community Leaderboard - Top 1000 $TIPN Stakers on Base
                        </p>
                        <div className="inline-flex items-center gap-2 px-4 py-2 bg-blue-900/30 border border-blue-500/50 rounded-full text-sm text-blue-300">
                            <span className="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></span>
                            Community Project - Not Official TIPNEARN Team
                        </div>
                    </div>

                    {/* Search */}
                    <div className="mb-8">
                        <div className="relative max-w-md mx-auto">
                            <input
                                type="text"
                                placeholder="Search by address..."
                                value={searchTerm}
                                onChange={(e) => {
                                    setSearchTerm(e.target.value);
                                    setCurrentPage(1);
                                }}
                                className="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:border-tipn-primary focus:outline-none focus:ring-2 focus:ring-tipn-primary/20 transition-all duration-200"
                            />
                            <div className="absolute inset-y-0 right-0 flex items-center pr-3">
                                <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    {/* Stats */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div className="bg-gray-800 rounded-lg p-6 text-center">
                            <div className="text-3xl font-bold text-tipn-primary mb-2">
                                {stakers?.length?.toLocaleString() || 0}
                            </div>
                            <div className="text-gray-300">Total Stakers</div>
                        </div>
                        <div className="bg-gray-800 rounded-lg p-6 text-center">
                            <div className="text-3xl font-bold text-tipn-primary mb-2">
                                {stakers ? Math.floor(stakers.reduce((sum, s) => sum + s.amount, 0) / 1e18).toLocaleString() : 0}
                            </div>
                            <div className="text-gray-300">Total TIPN Staked</div>
                        </div>
                        <div className="bg-gray-800 rounded-lg p-6 text-center">
                            <div className="text-3xl font-bold text-tipn-primary mb-2">Base</div>
                            <div className="text-gray-300">Network</div>
                        </div>
                    </div>

                    {/* Leaderboard Table */}
                    <div className="bg-gray-800 rounded-lg overflow-hidden shadow-xl">
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-700 border-b border-gray-600">
                                    <tr>
                                        <th className="px-6 py-4 text-left font-semibold">Rank</th>
                                        <th className="px-6 py-4 text-left font-semibold">Address</th>
                                        <th className="px-6 py-4 text-right font-semibold">Staked Amount</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-700">
                                    {paginatedStakers.map((staker, index) => (
                                        <LeaderboardRow 
                                            key={staker.address} 
                                            staker={staker} 
                                            index={startIndex + index} 
                                        />
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* Pagination */}
                    {totalPages > 1 && (
                        <div className="mt-8 flex justify-center">
                            <nav className="flex items-center space-x-2">
                                <button
                                    onClick={() => handlePageChange(currentPage - 1)}
                                    disabled={currentPage === 1}
                                    className="px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors duration-200"
                                >
                                    Previous
                                </button>
                                
                                {[...Array(Math.min(5, totalPages))].map((_, i) => {
                                    let pageNum;
                                    if (totalPages <= 5) {
                                        pageNum = i + 1;
                                    } else if (currentPage <= 3) {
                                        pageNum = i + 1;
                                    } else if (currentPage >= totalPages - 2) {
                                        pageNum = totalPages - 4 + i;
                                    } else {
                                        pageNum = currentPage - 2 + i;
                                    }
                                    
                                    return (
                                        <button
                                            key={pageNum}
                                            onClick={() => handlePageChange(pageNum)}
                                            className={`px-4 py-2 rounded-lg border transition-colors duration-200 ${
                                                currentPage === pageNum
                                                    ? 'bg-tipn-primary text-white border-tipn-primary'
                                                    : 'bg-gray-800 border-gray-600 hover:bg-gray-700'
                                            }`}
                                        >
                                            {pageNum}
                                        </button>
                                    );
                                })}
                                
                                <button
                                    onClick={() => handlePageChange(currentPage + 1)}
                                    disabled={currentPage === totalPages}
                                    className="px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-700 transition-colors duration-200"
                                >
                                    Next
                                </button>
                            </nav>
                        </div>
                    )}

                    {/* Footer */}
                    <div className="mt-16 text-center text-gray-400">
                        <div className="border-t border-gray-700 pt-8">
                            <p className="mb-4">
                                This is a <strong className="text-tipn-primary">community-built</strong> project and is not affiliated with the official TIPNEARN team.
                            </p>
                            <div className="flex flex-wrap justify-center gap-6 text-sm">
                                <a href="https://base.org" target="_blank" rel="noopener noreferrer" className="hover:text-tipn-primary transition-colors">
                                    Built on Base âš¡
                                </a>
                                <span className="text-gray-600">â€¢</span>
                                <span>Data updates every 30 seconds</span>
                                <span className="text-gray-600">â€¢</span>
                                <span>Open Source Community Project</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // App component
        const App = () => {
            const [queryClient] = useState(() => new ReactQuery.QueryClient({
                defaultOptions: {
                    queries: {
                        retry: 3,
                        staleTime: 5 * 60 * 1000,
                    },
                },
            }));

            return (
                <QueryClientProvider client={queryClient}>
                    <TipnLeaderboard />
                </QueryClientProvider>
            );
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
